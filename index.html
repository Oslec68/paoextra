<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Visita Lojas GPA</title>
<style>
:root { --azul:#1e3a8a; --verde:#0a7a3c; }
*{margin:0;padding:0;box-sizing:border-box}
body{font:14px Arial;background:#f5f5f5;color:#111;min-height:100vh;display:flex;flex-direction:column}
header{background:var(--azul);text-align:center;padding:15px 0;color:#fff}
header h1{font-size:22px;margin-bottom:5px}
header small{font-size:12px;opacity:0.9}
#weather{margin-top:8px;font-size:12px;opacity:0.9}
form{flex:1;padding:10px}
section{background:#fff;margin:10px 0;padding:15px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
label{display:block;font-size:12px;font-weight:bold;margin-bottom:5px;color:#333}
input,textarea{width:100%;padding:10px;font-size:14px;border:1px solid #ddd;border-radius:6px;margin-bottom:10px}
input:focus,textarea:focus{outline:none;border-color:var(--azul)}
input[readonly]{background:#f5f5f5;color:#666}
textarea{height:60px;resize:none;font-family:inherit}
.row{display:flex;gap:10px}
.row > div{flex:1}
.cod{flex:0 0 80px}
button{padding:12px 20px;font-size:14px;font-weight:bold;border:none;border-radius:6px;cursor:pointer;margin:5px}
.btn-toggle{background:#e9ecef;color:#333;width:100%}
.btn-toggle:hover{background:#dee2e6}
.btn-limpar{background:#6c757d;color:#fff}
.btn-finalizar{background:var(--verde);color:#fff}
.btn-limpar:hover{background:#5a6268}
.btn-finalizar:hover{background:#087a32}
.hidden{display:none}

/* Estilos do checklist */
.chk-item{
  display:flex;
  align-items:flex-start;
  gap:10px;
  padding:10px;
  border:1px solid #e9ecef;
  border-radius:8px;
  margin-bottom:8px;
  background:#f8f9fa;
  flex-wrap:wrap;
}
.chk-item input[type="checkbox"]{
  width:18px;
  height:18px;
  margin:0;
  flex-shrink:0;
}
.chk-item span{
  flex:1;
  font-weight:500;
  min-width:120px;
}
.status-emojis{
  display:flex;
  gap:3px;
  align-items:center;
  flex-shrink:0;
}
.emoji-btn{
  width:36px;
  height:36px;
  border:none;
  background:transparent;
  cursor:pointer;
  border-radius:6px;
  font-size:18px;
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.2s ease;
}
.emoji-btn:hover{
  background:#e9ecef;
  transform:scale(1.05);
}
.emoji-btn.active{
  background:#007bff !important;
  transform:scale(1.1);
  box-shadow:0 2px 8px rgba(0,123,255,0.3);
  border:2px solid #0056b3;
}
.obs-field{
  width:100%;
  margin-top:8px;
  padding:8px;
  border:1px solid #ddd;
  border-radius:4px;
  font-size:12px;
  display:none;
  flex-basis:100%;
}
.chk-item.has-red .obs-field{
  display:block;
}

.checkbox-item{display:flex;align-items:center;gap:8px;padding:5px;border-radius:4px;margin-bottom:3px}
.checkbox-item:hover{background:#f8f9fa}
.checkbox-item input[type="checkbox"]{width:16px;height:16px;margin:0}
.checkbox-item .texto{flex:1;font-size:13px}
.btn-excluir{background:#dc3545;color:white;border:none;border-radius:3px;padding:2px 6px;font-size:10px;cursor:pointer}
.btn-excluir:hover{background:#c82333}
.metrics{background:#f8f9fa;padding:15px;border-radius:8px;margin-top:10px}
.metrics-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
footer{background:#fff;padding:15px;display:flex;gap:10px;box-shadow:0 -2px 4px rgba(0,0,0,0.1)}
footer button{flex:1}
#status{text-align:center;padding:10px;font-weight:bold}

/* Weather display */
.weather-info{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  margin-top:8px;
}
.weather-info span{
  font-size:12px;
}
</style>
</head>
<body>

<header>
  <h1>ğŸ›’ Visita Lojas GPA</h1>
  <small id="clock"></small>
  <div class="weather-info">
    <span id="weather-emoji">ğŸŒ¤ï¸</span>
    <span id="weather-desc">Campinas â€¢ Tarde</span>
    <span id="temp">26Â°C</span>
  </div>
</header>

<form>
<section>
  <div class="row">
    <div class="cod">
      <label>CÃ³digo</label>
      <input id="cod" maxlength="4" placeholder="0000" onkeyup="buscarLoja()">
    </div>
    <div>
      <label>Nome da Loja</label>
      <input id="nome" readonly placeholder="Digite o cÃ³digo da loja">
    </div>
  </div>
  <div>
    <label>Cidade</label>
    <input id="cidade" readonly placeholder="Cidade serÃ¡ preenchida automaticamente">
  </div>
</section>

<section>
  <div class="row">
    <div>
      <label>Gerente</label>
      <input id="gerente" placeholder="Nome do gerente">
    </div>
    <div>
      <label>WhatsApp</label>
      <input id="whats" placeholder="(11) 99999-9999">
    </div>
  </div>
</section>

<section>
  <label>UsuÃ¡rio</label>
  <input id="usuario" placeholder="Seu nome">
  
  <button type="button" class="btn-toggle" onclick="toggleMetricas()">ğŸ“Š MÃ©tricas <span id="badge-metrics">(0)</span></button>
  
  <div id="metricas" class="hidden">
    <div class="metrics">
      <div class="metrics-grid">
        <div>
          <label>ğŸ’° Venda Mensal (R$)</label>
          <input id="venda" placeholder="0,00" onblur="formatarMoeda(this)" oninput="contarMetricas()">
        </div>
        <div>
          <label>ğŸ“ˆ VariaÃ§Ã£o (%)</label>
          <input id="variacao" placeholder="0" type="number" oninput="contarMetricas()">
        </div>
        <div>
          <label>ğŸ“‰ Perda (R$)</label>
          <input id="perda" placeholder="0,00" onblur="formatarMoeda(this)" oninput="contarMetricas()">
        </div>
        <div>
          <label>ğŸš« Ruptura (%)</label>
          <input id="ruptura" placeholder="0" type="number" max="100" oninput="contarMetricas()">
        </div>
      </div>
    </div>
  </div>
</section>

<section>
  <button type="button" class="btn-toggle" onclick="toggleChecklist()">ğŸ“‹ Checklist <span id="badge-check">(0)</span></button>
  
  <div id="checklistSec">
    <section>
      <div class="chk-group" id="lista">
        <div class="chk-item">
          <input type="checkbox" value="Ruptura" onchange="contarChecklist()">
          <span>Ruptura</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
        <div class="chk-item">
          <input type="checkbox" value="PreÃ§o errado" onchange="contarChecklist()">
          <span>PreÃ§o errado</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
        <div class="chk-item">
          <input type="checkbox" value="Layout inadequado" onchange="contarChecklist()">
          <span>Layout inadequado</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
        <div class="chk-item">
          <input type="checkbox" value="Limpeza" onchange="contarChecklist()">
          <span>Limpeza</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
        <div class="chk-item">
          <input type="checkbox" value="Atendimento" onchange="contarChecklist()">
          <span>Atendimento</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
        <div class="chk-item">
          <input type="checkbox" value="ExposiÃ§Ã£o" onchange="contarChecklist()">
          <span>ExposiÃ§Ã£o</span>
          <div class="status-emojis">
            <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
            <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
            <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
          </div>
          <input type="text" class="obs-field" placeholder="Descreva o problema...">
        </div>
      </div>
      <div class="row">
        <input id="novo" placeholder="Outro item">
        <button type="button" class="chk-btn" style="flex:0 0 60px" onclick="adicionarItem()">+Add</button>
      </div>
    </section>
  </div>
</section>

<section>
  <label>ObservaÃ§Ãµes</label>
  <textarea id="obs" placeholder="ObservaÃ§Ãµes da visita"></textarea>
</section>

<section>
  <label>Fotos</label>
  <div style="display:flex;gap:10px;align-items:center">
    <input type="file" id="fotos" accept="image/*" multiple style="flex:1">
    <button type="button" onclick="abrirCamera()" style="padding:10px 15px;background:#007bff;color:white;border:none;border-radius:6px;font-size:12px;font-weight:bold">ğŸ“· CÃ¢mera</button>
  </div>
</section>

<div id="status"></div>

<footer>
  <button type="button" class="btn-limpar" onclick="limpar()">ğŸ—‘ï¸ Limpar</button>
  <button type="button" class="btn-finalizar" onclick="finalizar()">âœ… Finalizar</button>
</footer>

<script>
// CARREGA LOJAS DE ARQUIVO JSON EXTERNO
let lojas = {};

// Dados internos das lojas como fallback
const lojasInternas = {
  "0001": {"nome": "PA JARDIM PAULISTA", "cidade": "SAO PAULO"},
  "0003": {"nome": "PA NOVA ALIANCA", "cidade": "RIBEIRAO PRETO"},
  "0004": {"nome": "PA ANALIA FRANCO", "cidade": "SAO PAULO"},
  "0014": {"nome": "PA SOROCABA A B VIST", "cidade": "SOROCABA"},
  "0018": {"nome": "PA SANTOS CENTRO", "cidade": "SANTOS"},
  "0022": {"nome": "PA VALINHOS PORTAL", "cidade": "VALINHOS"},
  "0026": {"nome": "PA CAMPINAS CASTELO", "cidade": "CAMPINAS"},
  "0037": {"nome": "PA CAMPINAS CAMBUI", "cidade": "CAMPINAS"},
  "0044": {"nome": "EX SANTOS MACUCO", "cidade": "SANTOS"},
  "0052": {"nome": "PA GUARUJA PUGLISI", "cidade": "GUARUJA"},
  "0069": {"nome": "EX P. G. CENTRO", "cidade": "PRAIA GRANDE"},
  "0122": {"nome": "PA ARACATUBA", "cidade": "ARACATUBA"},
  "0186": {"nome": "PA TAUBATE INDEP", "cidade": "TAUBATE"},
  "0189": {"nome": "PA CAMPINAS PROENCA", "cidade": "CAMPINAS"},
  "0205": {"nome": "PA S.VICENTE ITARARE", "cidade": "SAO VICENTE"},
  "0334": {"nome": "HUB FRESH - 0018", "cidade": "SANTOS"},
  "0361": {"nome": "PA AQUARIUS", "cidade": "SAO JOSE DOS CAMPOS"},
  "0412": {"nome": "PA HIPICA", "cidade": "CAMPINAS"},
  "0465": {"nome": "PA JUNDIAI", "cidade": "JUNDIAI"},
  "0505": {"nome": "PA CAMPINAS MANSOES", "cidade": "CAMPINAS"},
  "0506": {"nome": "PA ITU CENTRO II", "cidade": "ITU"},
  "0507": {"nome": "PA SALTO GETULIO VAR", "cidade": "SALTO"},
  "0508": {"nome": "PA ATIBAIA", "cidade": "ATIBAIA"},
  "0660": {"nome": "PA SOROCABA CAMPOLIM", "cidade": "SOROCABA"},
  "0692": {"nome": "EX SANTOS PEDREIRA", "cidade": "SANTOS"},
  "0745": {"nome": "PA PRAIA GRD C FORTE", "cidade": "PRAIA GRANDE"},
  "1002": {"nome": "PA ITU CENTRO", "cidade": "ITU"},
  "1005": {"nome": "PA PERUIBE", "cidade": "PERUIBE"},
  "1021": {"nome": "PA RIB PRETO INDEPEN", "cidade": "RIBEIRAO PRETO"},
  "1175": {"nome": "PA S.J.C. SHOPPING", "cidade": "SAO JOSE DOS CAMPOS"},
  "1182": {"nome": "PA ARARAQUARA SHOPP", "cidade": "ARARAQUARA"},
  "1185": {"nome": "VINHEDO", "cidade": "VINHEDO"},
  "1191": {"nome": "PA PRES PRUDENTE", "cidade": "PRESIDENTE PRUDENTE"},
  "1200": {"nome": "PA ASSIS", "cidade": "ASSIS"},
  "1293": {"nome": "PA BARAO GERALDO", "cidade": "CAMPINAS"},
  "1312": {"nome": "PA SAO CARLOS", "cidade": "SAO CARLOS"},
  "1386": {"nome": "PA JUNDIAI CENTRO", "cidade": "JUNDIAI"},
  "1499": {"nome": "EX P. G. FORTE", "cidade": "PRAIA GRANDE"},
  "1609": {"nome": "PA AVARE", "cidade": "AVARE"},
  "1724": {"nome": "PA RIBEIRAO PRETO JD", "cidade": "RIBEIRAO PRETO"},
  "1739": {"nome": "PA ATIBAIA JARDIM", "cidade": "ATIBAIA"},
  "1745": {"nome": "EX SANTOS APARECIDA", "cidade": "SANTOS"},
  "1748": {"nome": "EX MONGAGUA", "cidade": "MONGAGUA"},
  "1750": {"nome": "EX SANTOS VILA NOV", "cidade": "SANTOS"},
  "1751": {"nome": "PA PERUIBE CENTRO", "cidade": "PERUIBE"},
  "1753": {"nome": "PA PRAIA GRD BOQUIA", "cidade": "PRAIA GRANDE"},
  "1758": {"nome": "PA SANTOS BARTOLOMEU", "cidade": "SANTOS"},
  "1774": {"nome": "PA SAO SEBASTIAO", "cidade": "SAO SEBASTIAO"},
  "1875": {"nome": "EX GUARUJA JARDIM", "cidade": "GUARUJA"},
  "1878": {"nome": "PA CAMPINAS SOUZA", "cidade": "CAMPINAS"},
  "2050": {"nome": "PA RIVIERA SHOPPING", "cidade": "BERTIOGA"},
  "2078": {"nome": "PA ITANHAEM", "cidade": "ITANHAEM"},
  "2329": {"nome": "PA PIRACICABA", "cidade": "PIRACICABA"},
  "2333": {"nome": "PA TAUBATE VILA SAO", "cidade": "TAUBATE"},
  "2354": {"nome": "PA GUARUJA TEJEREBA", "cidade": "GUARUJA"},
  "2373": {"nome": "PA PARQUE PRADO", "cidade": "CAMPINAS"},
  "2402": {"nome": "PA S J DO RIO PRETO", "cidade": "SAO JOSE RIO PRETO"},
  "2424": {"nome": "PA S.J.R.P. JOCKEY", "cidade": "SAO JOSE DO RIO PRET"},
  "2432": {"nome": "PA GUARUJA PITANGU", "cidade": "GUARUJA"},
  "2438": {"nome": "PA JOSE MENINO", "cidade": "SANTOS"},
  "2449": {"nome": "PA BAURU JD. ESTORIL", "cidade": "BAURU"},
  "2465": {"nome": "PA CAMPINAS ITAPURA", "cidade": "CAMPINAS"},
  "2474": {"nome": "PA MARILIA", "cidade": "MARILIA"},
  "2481": {"nome": "PA BOTUCATU", "cidade": "BOTUCATU"},
  "5171": {"nome": "PA LIMEIRA JD PARQUE", "cidade": "LIMEIRA"},
  "5659": {"nome": "BARATEIRO LEME", "cidade": "LEME"},
  "5679": {"nome": "COMPRE BEM GUARUJA", "cidade": "GUARUJA"},
  "5680": {"nome": "COMPRE BEM SANTOS", "cidade": "SANTOS"},
  "5682": {"nome": "EX GUARUJA JOAO PES", "cidade": "GUARUJA"},
  "5683": {"nome": "BARATEIRO BEBEDOURO", "cidade": "BEBEDOURO"},
  "6767": {"nome": "PA PIRACICABA PAULIS", "cidade": "PIRACICABA"},
  "8666": {"nome": "PA RIBEIRAO PRETO", "cidade": "RIBEIRAO PRETO"}
};

// Usa dados internos como padrÃ£o
lojas = lojasInternas;

// CONFIGURAÃ‡ÃƒO DO TELEGRAM
const BOT_TOKEN = "7650475884:AAEicrlr9uiaRJQEMHAAyU2Oh3lAkqVzoTQ";
const CHAT_ID = "1491404284";

// FUNÃ‡ÃƒO DE BUSCA DA LOJA
function buscarLoja() {
  const codigo = document.getElementById('cod').value;
  
  if (codigo.length === 4) {
    const loja = lojas[codigo];
    if (loja) {
      document.getElementById('nome').value = loja.nome;
      document.getElementById('cidade').value = loja.cidade;
      updateWeather(loja.cidade);
    } else {
      document.getElementById('nome').value = 'Loja nÃ£o encontrada';
      document.getElementById('cidade').value = '';
    }
  } else {
    document.getElementById('nome').value = '';
    document.getElementById('cidade').value = '';
  }
}

// FUNÃ‡ÃƒO DE CLIMA
function updateWeather(cidade) {
  const agora = new Date();
  const hora = agora.getHours();
  let icon, desc, temp;
  
  const isInterior = !['SAO PAULO', 'SANTOS', 'GUARUJA', 'PRAIA GRANDE', 'SAO VICENTE'].includes(cidade.toUpperCase());
  const tempAdjust = isInterior ? 2 : 0;
  
  if (hora >= 6 && hora < 12) {
    icon = 'ğŸŒ…'; desc = 'ManhÃ£'; temp = `${18 + tempAdjust}`;
  } else if (hora >= 12 && hora < 18) {
    icon = 'â˜€ï¸'; desc = 'Tarde'; temp = `${26 + tempAdjust}`;
  } else if (hora >= 18 && hora < 21) {
    icon = 'ğŸŒ‡'; desc = 'Entardecer'; temp = `${22 + tempAdjust}`;
  } else {
    icon = 'ğŸŒ™'; desc = 'Noite'; temp = `${18 + tempAdjust}`;
  }
  
  document.getElementById('temp').textContent = `${temp}Â°C`;
  document.getElementById('weather-desc').textContent = `${cidade} â€¢ ${desc}`;
  document.getElementById('weather-emoji').textContent = icon;
}

// FUNÃ‡Ã•ES DOS BOTÃ•ES
function toggleChecklist() {
  const sec = document.getElementById('checklistSec');
  if (sec.style.display === 'none' || sec.style.display === '') {
    sec.style.display = 'block';
  } else {
    sec.style.display = 'none';
  }
}

function toggleMetricas() {
  const div = document.getElementById('metricas');
  if (div) div.classList.toggle('hidden');
}

function contarMetricas() {
  const inputs = document.querySelectorAll('#metricas input');
  let count = 0;
  inputs.forEach(input => {
    if (input.value.trim() !== '') count++;
  });
  document.getElementById('badge-metrics').textContent = `(${count})`;
}

function contarChecklist() {
  const checked = document.querySelectorAll('#lista input:checked').length;
  document.getElementById('badge-check').textContent = `(${checked})`;
}

function setStatus(button, status) {
  const item = button.closest('.chk-item');
  const allButtons = item.querySelectorAll('.emoji-btn');
  
  // Remove active de todos os botÃµes do item
  allButtons.forEach(btn => btn.classList.remove('active'));
  
  // Adiciona active no botÃ£o clicado
  button.classList.add('active');
  
  // Se Ã© vermelho, mostra campo de observaÃ§Ã£o
  if (status === 'red') {
    item.classList.add('has-red');
  } else {
    item.classList.remove('has-red');
  }
  
  // SEMPRE marca o checkbox quando clica em qualquer emoji
  const checkbox = item.querySelector('input[type="checkbox"]');
  checkbox.checked = true;
  contarChecklist();
  
  // Log para debug
  console.log('Status definido:', status, 'Checkbox marcado:', checkbox.checked);
}

function adicionarItem() {
  const txt = document.getElementById('novo').value.trim();
  if (!txt) return;
  
  const novoItem = document.createElement('div');
  novoItem.className = 'chk-item';
  
  novoItem.innerHTML = `
    <input type="checkbox" value="${txt}" onchange="contarChecklist()">
    <span>${txt}</span>
    <div class="status-emojis">
      <button class="emoji-btn" onclick="setStatus(this, 'green')" data-status="green">ğŸŸ¢</button>
      <button class="emoji-btn" onclick="setStatus(this, 'yellow')" data-status="yellow">ğŸŸ¡</button>
      <button class="emoji-btn" onclick="setStatus(this, 'red')" data-status="red">ğŸ”´</button>
    </div>
    <input type="text" class="obs-field" placeholder="Descreva o problema...">
  `;
  
  document.getElementById('lista').appendChild(novoItem);
  document.getElementById('novo').value = '';
  contarChecklist();
}

function excluirItem(botao) {
  if (confirm('Excluir este item do checklist?')) {
    botao.parentElement.remove();
    contarChecklist();
  }
}

function abrirCamera() {
  const input = document.getElementById('fotos');
  input.setAttribute('capture', 'environment');
  input.click();
}

function formatarMoeda(input) {
  let value = input.value.replace(/\D/g, '');
  if (value) {
    value = parseInt(value, 10);
    input.value = (value / 100).toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    });
  }
}

// FUNÃ‡ÃƒO DE ENVIO PARA TELEGRAM
async function finalizar() {
  const codigo = document.getElementById('cod').value;
  const usuario = document.getElementById('usuario').value;
  
  if (!codigo || !usuario) {
    document.getElementById('status').innerHTML = '<span style="color:red">âš ï¸ Preencha cÃ³digo da loja e usuÃ¡rio</span>';
    return;
  }
  
  // Coleta dados do checklist
  const checklistMarcados = [...document.querySelectorAll('#lista input:checked')]
    .map(input => input.value)
    .join(', ') || 'Nenhum';
  
  // Monta mensagem para Telegram
  const mensagem = "ğŸ›’ *Visita GPA*\n" +
                  "â€¢ Loja: *" + document.getElementById('nome').value + "* (" + codigo + ") â€“ " + document.getElementById('cidade').value + "\n" +
                  "â€¢ Gerente: " + document.getElementById('gerente').value + " â€“ " + document.getElementById('whats').value + "\n" +
                  "â€¢ UsuÃ¡rio: " + usuario + "\n" +
                  "â€¢ Checklist: " + checklistMarcados + "\n" +
                  "â€¢ Obs: " + (document.getElementById('obs').value || 'â€”');
  
  try {
    document.getElementById('status').innerHTML = '<span style="color:blue">ğŸ“¤ Enviando...</span>';
    
    await fetch("https://api.telegram.org/bot" + BOT_TOKEN + "/sendMessage", {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        chat_id: CHAT_ID, 
        text: mensagem, 
        parse_mode: 'Markdown' 
      })
    });
    
    document.getElementById('status').innerHTML = '<span style="color:green">âœ… Enviado para Telegram!</span>';
  } catch(e) {
    document.getElementById('status').innerHTML = '<span style="color:red">âŒ Erro no envio</span>';
  }
}

function limpar() {
  if (confirm('Limpar todos os dados?')) {
    document.querySelectorAll('input, textarea').forEach(el => {
      if (el.type === 'checkbox') el.checked = false;
      else el.value = '';
    });
    
    // Fecha checklist
    document.getElementById('checklistSec').style.display = 'none';
    
    document.getElementById('badge-check').textContent = '(0)';
    document.getElementById('badge-metrics').textContent = '(0)';
    document.getElementById('status').innerHTML = '';
    updateWeather('CAMPINAS');
  }
}

function updateClock() {
  document.getElementById('clock').textContent = new Date().toLocaleString('pt-BR');
}

// INICIALIZAÃ‡ÃƒO
setInterval(updateClock, 1000);
updateClock();
updateWeather('CAMPINAS');

console.log('Sistema iniciado com', Object.keys(lojas).length, 'lojas');
</script>
</body>
</html>